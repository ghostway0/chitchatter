!function(){var t,e,i,o,n,s,r,a;(n=t||(t={})).GET_SDK_CONFIG="getSdkConfig",n.IS_EMBEDDED="embed",n.PARENT_DOMAIN="parentDomain",(s=e||(e={})).CONFIG="config",s.CONFIG_REQUESTED="configRequested",(r=i||(i={})).COLOR_MODE="color-mode",r.PLAY_MESSAGE_SOUND="play-message-sound",r.ROOM_NAME="room",r.ROOT_URL="root-url",r.USER_ID="user-id",r.USER_NAME="user-name";let l=t=>{let{data:e}=t;return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"payload"in e&&"object"==typeof e.payload};(a=o||(o={})).DARK="dark",a.LIGHT="light";let u=Object.values(o).map(String),h=t=>u.includes(t),d=["camera","microphone","display-capture","fullscreen"],c=["height","referrerpolicy","sandbox","style","width"];class g extends HTMLElement{static get observedAttributes(){return[...Object.values(i),...c]}get chatConfig(){var t,e;let o={};this.hasAttribute(i.USER_ID)&&(o.userId=null!==(t=this.getAttribute(i.USER_ID))&&void 0!==t?t:""),this.hasAttribute(i.USER_NAME)&&(o.customUsername=this.getAttribute(i.USER_NAME)),o.playSoundOnNewMessage=!!this.hasAttribute(i.PLAY_MESSAGE_SOUND);let n=null!==(e=this.getAttribute(i.COLOR_MODE))&&void 0!==e?e:"";return h(n)&&(o.colorMode=n),o}get rootUrl(){var t;return null!==(t=this.getAttribute(i.ROOT_URL))&&void 0!==t?t:"https://ghostway0.github.io/chitchatter/"}async listenForConfigRequest(){this.stopListeningForConfigRequest(),window.addEventListener("message",this.handleConfigRequestedMessage),this.configRequestExpirationTimout=setTimeout(()=>{console.error("[chitchatter-sdk] configuration was not sent successfully"),this.stopListeningForConfigRequest()},1e4)}updateIframeAttributes(){var e;let{iframe:o}=this,n=encodeURIComponent(null!==(e=this.getAttribute(i.ROOM_NAME))&&void 0!==e?e:window.location.href),s=new URLSearchParams({[t.IS_EMBEDDED]:"",[t.GET_SDK_CONFIG]:"",[t.PARENT_DOMAIN]:encodeURIComponent(window.location.origin)}),r=new URL(this.rootUrl);r.pathname=`public/${n}`,r.search=s.toString();let{href:a}=r;for(let t of(a!==o.getAttribute("src")&&o.setAttribute("src",a),c)){let e=this.getAttribute(t);null!==e&&o.setAttribute(t,e)}}connectedCallback(){let t=this.attachShadow({mode:"open"}),{iframe:e}=this;e.style.border="none",e.setAttribute("allow",d.join(";")),t.appendChild(e),e.addEventListener("load",()=>{this.listenForConfigRequest()})}disconnectedCallback(){this.stopListeningForConfigRequest()}attributeChangedCallback(t){this.updateIframeAttributes(),Object.values(i).map(String).includes(t)&&this.sendConfigToChat()}constructor(...t){super(...t),this.configRequestExpirationTimout=null,this.iframe=document.createElement("iframe"),this.sendConfigToChat=()=>{var t;let{iframe:i,rootUrl:o}=this,{origin:n}=new URL(o),s={name:e.CONFIG,payload:this.chatConfig};null===(t=i.contentWindow)||void 0===t||t.postMessage(s,n)},this.handleConfigRequestedMessage=t=>{let{rootUrl:i}=this,{origin:o}=new URL(i);o===t.origin&&l(t)&&t.data.name===e.CONFIG_REQUESTED&&(this.sendConfigToChat(),this.stopListeningForConfigRequest())},this.stopListeningForConfigRequest=()=>{window.removeEventListener("message",this.handleConfigRequestedMessage),null!==this.configRequestExpirationTimout&&(clearInterval(this.configRequestExpirationTimout),this.configRequestExpirationTimout=null)}}}window.customElements.define("chat-room",g)}();
//# sourceMappingURL=sdk.js.map
